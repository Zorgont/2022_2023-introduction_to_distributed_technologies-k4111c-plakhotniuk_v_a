University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FICT](https://fict.itmo.ru)

Course: [Introduction to distributed technologies](https://github.com/itmo-ict-faculty/introduction-to-distributed-technologies)

Year: 2022/2023

Group: K4111c

Author: Plakhotniuk Vladlen Aleksandrovich

Lab: Exam

# Что такое виртуализация? Какие виды бывают, чем виртуализация отличается от контейнеризации и отличается ли?

## Определение

Виртуализация — это абстракция аппаратной части от программной, обеспечивающая при этом логическую изоляцию
вычислительных процессов друг от друга, выполняемых на одном физическом ресурсе.

## Виды виртуализации

### Аппаратная виртуализация

Позволяет создавать независимые и изолированные друг от друга виртуальные машины с помощью программной имитации
ресурсов (процессора, памяти, сети, диска и др.) физического сервера. За создание и управление виртуальными машинами
отвечает Гипервизор.

### Виртуализация рабочих столов

Позволяет отделить логический рабочий стол (набор пользовательских программ, работающий под ОС) от аппаратной части.
Самая популярная технология - VDI (Virtual Desktop Infrastructure) – инфраструктура виртуальных рабочих столов. Каждый
пользователь VDI имеет имитацию операционной системы с необходимым набором программ на физическом сервере под
управлением гипервизора. В реальности VDI зачастую используется для обеспечения доступа сотрудников к внутренним
ресурсам компании.

### Виртуализация на уровне ОС (контейнеризация)

Позволяет запускать программное обеспечение изолировано друг от друга. Самая популярная технология - Docker. Контейнеры
более легковесны, чем виртуальные машины, поскольку они не имеют ядра операционной системы, а используют платформу
контейнеризации.

## Различия

При контейнеризации сущности не имеют оболочки ОС, а пользуются той, что предоставляется платформой виртуализации. А при
виртуализации предполагается, что виртуальные машины имеют слой приложений и слой ОС.

# Как работают CNI, типы CNI, особенности развертывания и эксплуатации.

## Определение

Container Network Interface (CNI) или сетевой интерфейс контейнеров объединяет поды в разных нодах. Существует много
различных поставщиков и плагинов CNI с разными наборами функций и возможностей. CNI инициализируют и администрируют
IP-адреса при создании и удалении контейнеров. Существует большое количество CNI плагинов, таких, как стандартный CNI
плагин k8s, Flannel, Calico, Canal и Weave Net. У них есть различия, поскольку не каждый сетевой плагин поддерживает
работу с NetworkPolicy. То не все плагины позволяют сконфигурировать сетевые политики.

## CNI плагин Calico

### Особенности

Calico добавляет свою политику GlobalNetworkPolicy. Она позволяет применять набор правил доступа по селектору не только
для подов, но и, например, для нодов. Например, с помощью Calico можно ограничить ICMP трафик между подами и нодами.
Используя Calico можно намного проще и понятнее сконфигурировать политики, чем используя стандартный API k8s. Стоит
отметить, что правила применяются для всех сетевых подключений, а не только к тем, что пришли извне (Ingress/Egress).

### Архитектура

Calico состоит из следующих компонент:

1. Felix. Это основной компонент Calico, выполняющий следующие функции:
    - Управление сетевыми интерфейсами: создание, проверка их работоспособности и настройка пересылки трафика.
    - Программирование ACL (Access Control List).
    - Уведомления о статусе сети: Felix записывает данные о проблемах и ошибках в etcd.
2. Плагин для оркестратора (OpenStack, Kubernetes).
3. В качестве хранилища Calico использует etcd. Если Calico используется в кластере k8s, то они используют одну и ту же
   базу etcd.
4. BGP клиент, разворачивающийся на каждой ноде, на которой размещен Felix. Задачей BGP клиента является считывание
   настроек маршрутизации и их распространение на другие ноды.

## Развертывания и эксплуатации Calico в кластере k8s

Первым делом необходимо поднять кластер Kubernetes, причем, для большей наглядности, в многонодовом моде. Помимо этого,
необходимо указать, что в качестве CNI будет использовать не дефолтный k8s CNI, а именно Calico.

Следующим шагом нужно применить манифест calico_ctl, который может быть найден на официальном сайте, чтобы Calico
полноценно заработал в кластере.

Далее, например, можно создать IP-пулы для разных зон. Допустим, одна нода будет находиться в IP-pool east, а другая в
west. Это можно сделать командой присвоения label для нод. В результате поды, которые будут запускаться на этих нодах
будут получать IP-адреса исходя из IP-пула, присвоенного ноде, на которой поднят конкретный под.

При этом, поскольку не наострены какие-либо политики безопасности, поды смогут спокойно пинговать и взаимодействовать
друг с другом. Но это можно изменить с помощью Calico.

Если говорить о кластере Kubernetes, то по сути говоря, Calico представляет собой набор под, запущенных в некотором
namespace на каждой ноде кластера.